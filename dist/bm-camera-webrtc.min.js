/*
 * @blinkmobile/camera: v0.0.3 | https://github.com/blinkmobile/camera
 * (c) 2017 BlinkMobile | Released under the ISC license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bmCameraFactory=t()}(this,function(){"use strict";function e(e){if(!e)throw new TypeError("WebRTCCamera expects a video element during instansiation");this.defaultConstraints={video:!0,audio:!1},this.availableDevices=[],o.set(this,{videoEl:e,stream:null,videoTrack:null,authorised:!1,result:null})}function t(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return i.unshift(null),new(e.bind.apply(e,i))}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=new WeakMap;return e.prototype.useDevice=function(e){if(this.close(),!("deviceId"in e))throw new TypeError("Invalid device selected, must be of type MediaDeviceInfo");var t="object"===i(this.defaultConstraints.video)?this.defaultConstraints.video:{};return t.deviceId={exact:e.deviceId},this.defaultConstraints.video=t,this.open()},e.prototype.getDevices=function(){var e=this;return o.get(this).authorised?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(t){return e.availableDevices=t.filter(function(e){return"videoinput"===e.kind.toLowerCase()}),e.availableDevices}):Promise.reject(new Error("Media Devices API not supported in this browser")):Promise.resolve([])},e.prototype.open=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultConstraints;return t=Object.assign({},this.defaultConstraints,t),new Promise(function(i,r){getUserMedia(t,function(t,n){if(t)return r(t);var a=n.getVideoTracks(),s=o.get(e);return s.authorised=!0,a.length?(s.videoEl.addEventListener("canplay",i,{once:!0}),s.videoTrack=a[0],s.stream=n,void(s.videoEl.srcObject=n)):(s.stream=null,s.videoTrack=null,r(new Error("Could not get a video track from stream")))})})},e.prototype.getPicture=function(){if(!o.get(this).authorised)return Promise.reject(new DOMException("User has not authorised use of the camera","NotAllowedError"));var e=o.get(this),t=document.createElement("canvas"),i=t.getContext("2d"),r=e.videoEl;return t.width=r.videoWidth,t.height=r.videoHeight,i.drawImage(e.videoEl,0,0),Promise.resolve(t.toDataURL("image/png"))},e.prototype.close=function(){var e=o.get(this).videoTrack;e&&e.stop()},t});