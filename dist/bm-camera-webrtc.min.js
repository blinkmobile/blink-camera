/*
 * @blinkmobile/camera: v0.0.1 | https://github.com/blinkmobile/camera
 * (c) 2017 BlinkMobile | Released under the ISC license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bmCameraFactory=t()}(this,function(){"use strict";function e(e){if(!e)throw new TypeError("WebRTCCamera expects a video element during instansiation");this.defaultConstraints={video:!0,audio:!1},this.availableDevices=[],i.set(this,{videoEl:e,stream:null,videoTrack:null,authorised:!1,result:null})}function t(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return i.unshift(null),new(e.bind.apply(e,i))}var i=new WeakMap;return e.prototype.useDevice=function(e){if(this.stopVideo(),!("deviceId"in e))throw new TypeError("Invalid device selected, must be of type MediaDeviceInfo");this.defaultConstraints.video=this.defaultConstraints.video||{},this.defaultConstraints.video.deviceId={exact:e.deviceId}},e.prototype.getDevices=function(){var e=this;return i.get(this).authorised?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(t){return e.availableDevices=t.filter(function(e){return"videoinput"===e.kind.toLowerCase()}),e.availableDevices}):Promise.reject(new Error("Media Devices API not supported in this browser")):Promise.resolve([])},e.prototype.open=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultConstraints;return t=Object.assign({},this.defaultConstraints,t),new Promise(function(r,o){getUserMedia(t,function(t,n){if(t)return o(t);var a=n.getVideoTracks(),s=i.get(e);return s.authorised=!0,a.length?(s.videoEl.addEventListener("canplay",r,{once:!0}),s.videoTrack=a[0],s.stream=n,void(s.videoEl.srcObject=n)):(s.stream=null,s.videoTrack=null,o(new Error("Could not get a video track from stream")))})})},e.prototype.getPicture=function(){if(!i.get(this).authorised)return Promise.reject(new DOMException("User has not authorised use of the camera","NotAllowedError"));var e=i.get(this),t=document.createElement("canvas"),r=t.getContext("2d"),o=e.videoEl;return t.width=o.videoWidth,t.height=o.videoHeight,r.drawImage(e.videoEl,0,0),e.result=t.toDataURL("image/png"),Promise.resolve(e.result)},e.prototype.close=function(){i.get(this).videoTrack.stop()},t});